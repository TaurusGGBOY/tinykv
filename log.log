rm -rf /tmp/*test-raftstore*
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestBasic2B|| true
=== RUN   TestBasic2B
2022/03/17 23:20:58.321015 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore866075250/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore866075250/snap/gen_1_5_5.meta: no such file or directory][0m
--- FAIL: TestBasic2B (0.22s)
2022/03/17 23:20:58.321518 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore866075250/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:20:58.321553 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore866075250/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore866075250/snap/gen_1_5_5.meta: no such file or directory][0m
panic: remove /tmp/test-raftstore866075250/snap/gen_1_5_5_default.sst.tmp: no such file or directory [recovered]
	panic: remove /tmp/test-raftstore866075250/snap/gen_1_5_5_default.sst.tmp: no such file or directory

goroutine 42 [running]:
testing.tRunner.func1.2(0xb28b00, 0xc00000f440)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1143 +0x332
testing.tRunner.func1(0xc000082c00)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1146 +0x4b6
panic(0xb28b00, 0xc00000f440)
	/home/ggb/sdk/go1.16.3/src/runtime/panic.go:965 +0x1b9
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).StartServer(0xc0000a9b60, 0x4)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:172 +0xc5
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).Start(0xc0000a9b60)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:140 +0xaf6
github.com/pingcap-incubator/tinykv/kv/test_raftstore.GenericTest(0xc000082c00, 0xbc284d, 0x2, 0x1, 0x62000000, 0xffffffffffffffff, 0xa56799a0000)
	/home/ggb/project/tinykv/kv/test_raftstore/test_test.go:179 +0x1b2
github.com/pingcap-incubator/tinykv/kv/test_raftstore.TestBasic2B(0xc000082c00)
	/home/ggb/project/tinykv/kv/test_raftstore/test_test.go:336 +0x65
testing.tRunner(0xc000082c00, 0xbf68f8)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1193 +0xef
created by testing.(*T).Run
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1238 +0x2b3
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	0.243s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestConcurrent2B|| true
=== RUN   TestConcurrent2B
2022/03/17 23:20:59.710268 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore993800081/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore993800081/snap/gen_1_5_5.meta: no such file or directory][0m
2022/03/17 23:21:00.722941 test_test.go:221: [0;31m[fatal] get wrong value, client 0
want:x 0 0 yx 0 1 yx 0 2 y
got: x 0 0 yx 0 1 yx 0 2 yx 0 2 y
[0m
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	1.240s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestUnreliable2B|| true
=== RUN   TestUnreliable2B
2022/03/17 23:21:01.893703 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore834946234/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:01.894104 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore834946234/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:01.894342 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore834946234/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:03.439257 test_test.go:221: [0;31m[fatal] get wrong value, client 3
want:x 3 0 yx 3 1 yx 3 2 y
got: x 3 0 yx 3 1 yx 3 2 yx 3 2 yx 3 2 y
[0m
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	1.680s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestOnePartition2B|| true
=== RUN   TestOnePartition2B
2022/03/17 23:21:04.841006 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore836609483/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:04.841723 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore836609483/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
--- FAIL: TestOnePartition2B (0.14s)
2022/03/17 23:21:04.842631 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore836609483/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore836609483/snap/gen_1_5_5.meta: no such file or directory][0m
panic: remove /tmp/test-raftstore836609483/snap/gen_1_5_5_default.sst.tmp: no such file or directory [recovered]
	panic: remove /tmp/test-raftstore836609483/snap/gen_1_5_5_default.sst.tmp: no such file or directory

goroutine 11 [running]:
testing.tRunner.func1.2(0xb28b00, 0xc000208360)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1143 +0x332
testing.tRunner.func1(0xc000001800)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1146 +0x4b6
panic(0xb28b00, 0xc000208360)
	/home/ggb/sdk/go1.16.3/src/runtime/panic.go:965 +0x1b9
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).StartServer(0xc000072fc0, 0x4)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:172 +0xc5
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).Start(0xc000072fc0)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:140 +0xaf6
github.com/pingcap-incubator/tinykv/kv/test_raftstore.TestOnePartition2B(0xc000001800)
	/home/ggb/project/tinykv/kv/test_raftstore/test_test.go:355 +0x73
testing.tRunner(0xc000001800, 0xbf6950)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1193 +0xef
created by testing.(*T).Run
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1238 +0x2b3
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	0.166s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestManyPartitionsOneClient2B|| true
=== RUN   TestManyPartitionsOneClient2B
2022/03/17 23:21:05.996178 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore313437975/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:05.996574 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore313437975/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
--- FAIL: TestManyPartitionsOneClient2B (0.11s)
2022/03/17 23:21:05.996751 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore313437975/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore313437975/snap/gen_1_5_5.meta: no such file or directory][0m
panic: remove /tmp/test-raftstore313437975/snap/gen_1_5_5_default.sst.tmp: no such file or directory [recovered]
	panic: remove /tmp/test-raftstore313437975/snap/gen_1_5_5_default.sst.tmp: no such file or directory

goroutine 44 [running]:
testing.tRunner.func1.2(0xb28b00, 0xc0001837e8)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1143 +0x332
testing.tRunner.func1(0xc0001f2300)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1146 +0x4b6
panic(0xb28b00, 0xc0001837e8)
	/home/ggb/sdk/go1.16.3/src/runtime/panic.go:965 +0x1b9
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).StartServer(0xc0001870e0, 0x2)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:172 +0xc5
github.com/pingcap-incubator/tinykv/kv/test_raftstore.(*Cluster).Start(0xc0001870e0)
	/home/ggb/project/tinykv/kv/test_raftstore/cluster.go:140 +0xaf6
github.com/pingcap-incubator/tinykv/kv/test_raftstore.GenericTest(0xc0001f2300, 0xbc284d, 0x2, 0x1, 0x62010000, 0xffffffffffffffff, 0xa58493a0000)
	/home/ggb/project/tinykv/kv/test_raftstore/test_test.go:179 +0x1b2
github.com/pingcap-incubator/tinykv/kv/test_raftstore.TestManyPartitionsOneClient2B(0xc0001f2300)
	/home/ggb/project/tinykv/kv/test_raftstore/test_test.go:405 +0x65
testing.tRunner(0xc0001f2300, 0xbf6948)
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1193 +0xef
created by testing.(*T).Run
	/home/ggb/sdk/go1.16.3/src/testing/testing.go:1238 +0x2b3
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	0.133s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestManyPartitionsManyClients2B|| true
=== RUN   TestManyPartitionsManyClients2B
2022/03/17 23:21:07.246033 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : rename /tmp/test-raftstore392544131/snap/gen_1_5_5.meta.tmp /tmp/test-raftstore392544131/snap/gen_1_5_5.meta: no such file or directory][0m
2022/03/17 23:21:07.246880 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore392544131/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:07.246877 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore392544131/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:07.247161 region_task.go:84: [0;31m[error] failed to generate snapshot!!!, [regionId: 1, err : stat /tmp/test-raftstore392544131/snap/gen_1_5_5_default.sst.tmp: no such file or directory][0m
2022/03/17 23:21:08.572277 test_test.go:221: [0;31m[fatal] get wrong value, client 1
want:x 1 0 yx 1 1 yx 1 2 y
got: x 1 0 yx 1 1 yx 1 2 yx 1 2 yx 1 2 y
[0m
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	1.481s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestPersistOneClient2B|| true
=== RUN   TestPersistOneClient2B
panic: runtime error: slice bounds out of range [:2298] with capacity 0

goroutine 266 [running]:
github.com/pingcap-incubator/tinykv/raft.(*RawNode).HasReady(0xc1878371a0, 0x10)
	/home/ggb/project/tinykv/raft/rawnode.go:182 +0x25d
github.com/pingcap-incubator/tinykv/kv/raftstore.(*peerMsgHandler).HandleRaftReady(0xc17ce16e28)
	/home/ggb/project/tinykv/kv/raftstore/peer_msg_handler.go:50 +0x137
github.com/pingcap-incubator/tinykv/kv/raftstore.(*raftWorker).run(0xc1866e9220, 0xc1859c5a40, 0xc18782d760)
	/home/ggb/project/tinykv/kv/raftstore/raft_worker.go:57 +0x346
created by github.com/pingcap-incubator/tinykv/kv/raftstore.(*Raftstore).startWorkers
	/home/ggb/project/tinykv/kv/raftstore/raftstore.go:270 +0xe6
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	6.679s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestPersistConcurrent2B|| true
=== RUN   TestPersistConcurrent2B
2022/03/17 23:21:17.562219 log.go:124: [0;31m[fatal] [Unable to open value log: Unable to preallocate value log file: no space left on device]
[0m
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore	0.203s
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestPersistConcurrentUnreliable2B|| true
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore [build failed]
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestPersistPartition2B|| true
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore [build failed]
FAIL
GO111MODULE=on go test -v --count=1 --parallel=1 -p=1 ./kv/test_raftstore -run ^TestPersistPartitionUnreliable2B|| true
FAIL	github.com/pingcap-incubator/tinykv/kv/test_raftstore [build failed]
FAIL
rm -rf /tmp/*test-raftstore*
LOG_LEVEL= error
